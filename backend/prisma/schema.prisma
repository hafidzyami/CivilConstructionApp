generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model DemoSession {
  id                 Int                   @id @default(autoincrement())
  userId             Int
  createdAt          DateTime              @default(now())
  updatedAt          DateTime              @updatedAt
  cadData            DemoCadData?
  chatHistory        DemoChatHistory[]
  complianceResult   DemoComplianceResult?
  documents          DemoDocument[]
  infrastructureData DemoInfrastructure?
  ocrData            DemoOcr[]
}

model DemoComplianceResult {
  id                    Int         @id @default(autoincrement())
  sessionId             Int         @unique
  status                String
  overallScore          Int
  summary               String
  checks                Json
  applicableRegulations Json
  recommendations       String[]
  createdAt             DateTime    @default(now())
  updatedAt             DateTime    @updatedAt
  session               DemoSession @relation(fields: [sessionId], references: [id], onDelete: Cascade)
}

model DemoDocument {
  id           Int         @id @default(autoincrement())
  sessionId    Int
  fileName     String
  fileUrl      String
  mimeType     String
  fileSize     Int
  documentType String?
  uploadedAt   DateTime    @default(now())
  session      DemoSession @relation(fields: [sessionId], references: [id], onDelete: Cascade)

  @@index([sessionId])
}

model DemoCadData {
  id           Int         @id @default(autoincrement())
  sessionId    Int         @unique
  siteArea     Float?
  buildingArea Float?
  floorArea    Float?
  bcr          Float?
  far          Float?
  rawData      Json?
  createdAt    DateTime    @default(now())
  updatedAt    DateTime    @updatedAt
  dxfFileUrl   String?
  session      DemoSession @relation(fields: [sessionId], references: [id], onDelete: Cascade)
}

model DemoInfrastructure {
  id              Int         @id @default(autoincrement())
  sessionId       Int         @unique
  latitude        Float?
  longitude       Float?
  radius          Float?
  buildings       Json?
  roads           Json?
  railways        Json?
  waterways       Json?
  rawData         Json?
  createdAt       DateTime    @default(now())
  updatedAt       DateTime    @updatedAt
  labeledFeatures Json?
  session         DemoSession @relation(fields: [sessionId], references: [id], onDelete: Cascade)
}

model DemoOcr {
  id            Int         @id @default(autoincrement())
  sessionId     Int
  fileName      String
  fileUrl       String
  extractedText String?
  engine        String?
  documentType  String?
  rawData       Json?
  createdAt     DateTime    @default(now())
  session       DemoSession @relation(fields: [sessionId], references: [id], onDelete: Cascade)

  @@index([sessionId])
}

model DemoChatHistory {
  id            Int         @id @default(autoincrement())
  sessionId     Int
  chatSessionId String
  role          String
  content       String
  sources       Json?
  createdAt     DateTime    @default(now())
  session       DemoSession @relation(fields: [sessionId], references: [id], onDelete: Cascade)

  @@index([sessionId])
  @@index([chatSessionId])
}
